mapboxgl.accessToken="pk.eyJ1IjoicHJldHR5Z29vZHN0dWRpb3MiLCJhIjoiY2pkamx4aTZlMWt4dDJwbnF5a3ZmbTEzcyJ9.lu_9eqO1kmUMPf9LXU80yg";var map=new mapboxgl.Map({container:"map",style:"mapbox://styles/prettygoodstudios/cjdjnyk9047qy2rmm28tmk0m8"}),nav=new mapboxgl.NavigationControl;map.addControl(nav,"top-left"),$.get(ROOT_URL+"geo_json_api").then(function(a){for(var e=0;e<a.length;e++){var o=document.createElement("div");o.className="marker";var t=new mapboxgl.Marker(o,{offset:[0,-35]}).setLngLat([a[e].coordinates[1],a[e].coordinates[0]]).addTo(map),n="<h3>"+a[e].title+"</h3>",p="<p>"+a[e].address+"</p>",r="<p>Average Rating: "+a[e].average_score+"</p>";0==a[e].average_score&&(r="");var m="<image class='popup-image' src='"+a[e].img_url+"'></image>",s="<a href='"+ROOT_URL+a[e].url+"' class='button' data-turbolinks='false'>More Info</a>",l=(new mapboxgl.Popup).setHTML(n+p+r+m+s);t.setPopup(l)}}),$.get("http://ip-api.com/json").then(function(a){map.flyTo({center:[a.lon,a.lat],zoom:9})});