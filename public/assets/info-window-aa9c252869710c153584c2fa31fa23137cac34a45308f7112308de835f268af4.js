function copyKeys(t,e){t&&e&&Object.keys(e).forEach(s=>{t[s]=e[s]})}function mergeDefaultOptions(t){const e={};return copyKeys(e,_defaultOptions),copyKeys(e,t),Object.keys(_defaultOptions).forEach(t=>{const s=_defaultOptions[t];if("object"==typeof s){const i={};copyKeys(i,s),copyKeys(i,e[t]),e[t]=i}}),e}function parseAttribute(t,e){const s=/^(-{0,1}\.{0,1}\d+(\.\d+)?)[\s|\.]*(\w*)$/;if(t&&s.test(t)){const e=s.exec(t);return{value:1*e[1],units:e[3]||"px",original:t}}return e?parseAttribute(e):{original:e}}function setHTML(t,e){if(t){for(;t.firstChild;)t.removeChild(t.firstChild);e&&("string"==typeof e?t.innerHTML=e:t.appendChild(e))}}function oppositePlacement(t){return"top"===t?"bottom":"bottom"===t?"top":"left"===t?"right":"right"===t?"left":t}function capitalizePlacement(t){return t.charAt(0).toUpperCase()+t.slice(1)}function toLatLng(t){if(t!==undefined&&null!==t){if(t instanceof google.maps.LatLng)return t;if(t.lat!==undefined&&t.lng!==undefined)return new google.maps.LatLng(t)}return null}const _classPrefix="si-",_root2=1.41421356237,_inverseRoot2=.7071067811865474,_eventPrefix="snazzy-info-window-",_defaultShadow={h:"0px",v:"3px",blur:"6px",spread:"0px",color:"#000"},_defaultOptions={placement:"top",pointer:!0,openOnMarkerClick:!0,closeOnMapClick:!0,closeWhenOthersOpen:!1,showCloseButton:!0,panOnOpen:!0,edgeOffset:{top:20,right:20,bottom:20,left:20}},getGoogleClass=()=>"undefined"!=typeof google?google.maps.OverlayView:function(){};export default class SnazzyInfoWindow extends(getGoogleClass()){constructor(t){if(super(t),"undefined"==typeof google)return void console.warn("Snazzy Info Window: Google Maps is not defined!");this._html=null,this._opts=mergeDefaultOptions(t),this._callbacks=this._opts.callbacks||{},this._marker=this._opts.marker,this._map=this._opts.map,this._position=toLatLng(this._opts.position),this._isOpen=!1,this._listeners=[],this._marker&&this._opts.openOnMarkerClick&&this.trackListener(google.maps.event.addListener(this._marker,"click",()=>{this.getMap()||this.open()}),!0),this._position&&!this._opts.offset&&(this._opts.offset={top:"0px",left:"0px"});let e=t.placement||this._opts.position;("string"==typeof e||e instanceof String)&&(e=e.toLowerCase()),this._opts.placement="top"!==e&&"bottom"!==e&&"left"!==e&&"right"!==e?_defaultOptions.placement:e,(e=this._opts.position)===undefined||null===e||"string"==typeof e||e instanceof String||(this._opts.position=e),this._opts.border!==undefined&&!0!==this._opts.border||(this._opts.border={}),this._opts.pointer===undefined&&(this._opts.pointer=_defaultOptions.pointer),this._opts.shadow!==undefined&&!0!==this._opts.shadow||(this._opts.shadow={})}activateCallback(t){const e=this._callbacks[t];return e?e.apply(this):undefined}trackListener(t,e){this._listeners.push({listener:t,persistent:e})}clearListeners(t){this._listeners&&(this._listeners.forEach(e=>{!t&&e.persistent||(google.maps.event.removeListener(e.listener),e.listener=null)}),this._listeners=this._listeners.filter(t=>null!=t.listener))}isOpen(){return this._isOpen}open(){const t=this.activateCallback("beforeOpen");(t===undefined||t)&&(this._marker?this.setMap(this._marker.getMap()):this._map&&this._position&&this.setMap(this._map))}close(){const t=this.activateCallback("beforeClose");(t===undefined||t)&&(this.clearListeners(),this.setMap(null))}destroy(){this.getMap()&&this.setMap(null),this.clearListeners(!0)}setContent(t){this._opts.content=t,this._html&&this._html.content&&setHTML(this._html.content,t)}setPosition(t){this._position=toLatLng(t),this._isOpen&&this._position&&(this.draw(),this.resize(),this.reposition())}setWrapperClass(t){if(this._html&&this._html.wrapper){const e=this._html.wrapper;e.className=`${_classPrefix}wrapper-${this._opts.placement}`,this._opts.border&&(e.className+=` ${_classPrefix}has-border`),t&&(e.className+=` ${t}`)}this._opts.wrapperClass=t}getWrapper(){return this._html?this._html.wrapper:null}draw(){if(!this.getMap()||!this._html)return;if(!this._marker&&!this._position)return;const t=this._opts.offset;t&&(t.left&&(this._html.wrapper.style.marginLeft=t.left),t.top&&(this._html.wrapper.style.marginTop=t.top));const e=this._opts.backgroundColor;if(e&&(this._html.contentWrapper.style.backgroundColor=e,this._opts.pointer&&(this._html.pointerBg.style[`border${capitalizePlacement(this._opts.placement)}Color`]=e)),this._opts.padding&&(this._html.contentWrapper.style.padding=this._opts.padding,this._opts.shadow&&(this._html.shadowFrame.style.padding=this._opts.padding)),this._opts.borderRadius&&(this._html.contentWrapper.style.borderRadius=this._opts.borderRadius,this._opts.shadow&&(this._html.shadowFrame.style.borderRadius=this._opts.borderRadius)),this._opts.fontSize&&(this._html.wrapper.style.fontSize=this._opts.fontSize),this._opts.fontColor&&(this._html.contentWrapper.style.color=this._opts.fontColor),this._opts.pointer&&!0!==this._opts.pointer&&(this._opts.shadow&&(this._html.shadowPointer.style.width=this._opts.pointer,this._html.shadowPointer.style.height=this._opts.pointer),this._html.pointerBorder&&(this._html.pointerBorder.style.borderWidth=this._opts.pointer),this._html.pointerBg.style.borderWidth=this._opts.pointer),this._opts.border){let t=0;if(this._opts.border.width!==undefined&&(t=parseAttribute(this._opts.border.width,"0px"),this._html.contentWrapper.style.borderWidth=t.value+t.units),t=parseAttribute(`${t=Math.round((this._html.contentWrapper.offsetWidth-this._html.contentWrapper.clientWidth)/2)}px`,"0px"),this._opts.pointer){let e=Math.min(this._html.pointerBorder.offsetHeight,this._html.pointerBorder.offsetWidth);e=parseAttribute(`${e}px`,"0px");let s=Math.round(t.value*(_root2-1));s=Math.min(s,e.value),this._html.pointerBg.style.borderWidth=e.value-s+e.units;const i=capitalizePlacement(oppositePlacement(this._opts.placement));this._html.pointerBg.style[`margin${i}`]=s+t.units,this._html.pointerBg.style[this._opts.placement]=-t.value+t.units}const e=this._opts.border.color;e&&(this._html.contentWrapper.style.borderColor=e,this._html.pointerBorder&&(this._html.pointerBorder.style[`border${capitalizePlacement(this._opts.placement)}Color`]=e))}if(this._opts.shadow){const t=this._opts.shadow,e=e=>{const s=t[e];return s!==undefined&&null!=s};if(e("h")||e("v")||e("blur")||e("spread")||e("color")){const e=parseAttribute(t.h,_defaultShadow.h),s=parseAttribute(t.v,_defaultShadow.v),i=parseAttribute(t.blur,_defaultShadow.blur),o=parseAttribute(t.spread,_defaultShadow.spread),h=t.color||_defaultShadow.color,n=(t,e)=>`${t} ${e} ${i.original} ${o.original} ${h}`;this._html.shadowFrame.style.boxShadow=n(e.original,s.original);const r=_inverseRoot2*(e.value-s.value)+e.units,p=_inverseRoot2*(e.value+s.value)+s.units;this._html.shadowPointerInner&&(this._html.shadowPointerInner.style.boxShadow=n(r,p))}this._opts.shadow.opacity&&(this._html.shadowWrapper.style.opacity=this._opts.shadow.opacity)}const s=this.getProjection().fromLatLngToDivPixel(this._position||this._marker.position);s&&(this._html.floatWrapper.style.top=`${Math.floor(s.y)}px`,this._html.floatWrapper.style.left=`${Math.floor(s.x)}px`),this._isOpen||(this._isOpen=!0,this.resize(),this.reposition(),this.activateCallback("afterOpen"),google.maps.event.trigger(this.getMap(),`${_eventPrefix}opened`,this))}onAdd(){if(this._html)return;const t=(t,e)=>{if(t&&e)for(let s=0;s<e.length;s++){const i=e[s];i&&(t.className&&(t.className+=" "),t.className+=_classPrefix+i)}},e=(...e)=>{const s=document.createElement("div");return t(s,e),s};if(this._html={},this._html.wrapper=e(),this.setWrapperClass(this._opts.wrapperClass),this._opts.shadow&&(this._html.shadowWrapper=e(`shadow-wrapper-${this._opts.placement}`),this._html.shadowFrame=e("frame","shadow-frame"),this._html.shadowWrapper.appendChild(this._html.shadowFrame),this._opts.pointer&&(this._html.shadowPointer=e(`shadow-pointer-${this._opts.placement}`),this._html.shadowPointerInner=e(`shadow-inner-pointer-${this._opts.placement}`),this._html.shadowPointer.appendChild(this._html.shadowPointerInner),this._html.shadowWrapper.appendChild(this._html.shadowPointer)),this._html.wrapper.appendChild(this._html.shadowWrapper)),this._html.contentWrapper=e("frame","content-wrapper"),this._html.content=e("content"),this._opts.content&&setHTML(this._html.content,this._opts.content),this._opts.showCloseButton){if(this._opts.closeButtonMarkup){const t=document.createElement("div");setHTML(t,this._opts.closeButtonMarkup),this._html.closeButton=t.firstChild}else this._html.closeButton=document.createElement("button"),this._html.closeButton.setAttribute("type","button"),this._html.closeButton.innerHTML="&#215;",t(this._html.closeButton,["close-button"]);this._html.contentWrapper.appendChild(this._html.closeButton)}this._html.contentWrapper.appendChild(this._html.content),this._html.wrapper.appendChild(this._html.contentWrapper),this._opts.pointer&&(this._opts.border&&(this._html.pointerBorder=e(`pointer-${this._opts.placement}`,`pointer-border-${this._opts.placement}`),this._html.wrapper.appendChild(this._html.pointerBorder)),this._html.pointerBg=e(`pointer-${this._opts.placement}`,`pointer-bg-${this._opts.placement}`),this._html.wrapper.appendChild(this._html.pointerBg)),this._html.floatWrapper=e("float-wrapper"),this._html.floatWrapper.appendChild(this._html.wrapper),this.getPanes().floatPane.appendChild(this._html.floatWrapper);const s=this.getMap();this.clearListeners(),this._opts.closeOnMapClick&&this.trackListener(google.maps.event.addListener(s,"click",()=>{this.close()})),this._opts.closeWhenOthersOpen&&this.trackListener(google.maps.event.addListener(s,`${_eventPrefix}opened`,t=>{this!==t&&this.close()})),this._previousWidth=null,this._previousHeight=null,this.trackListener(google.maps.event.addListener(s,"bounds_changed",()=>{const t=s.getDiv(),e=t.offsetWidth,i=t.offsetHeight,o=this._previousWidth,h=this._previousHeight;null!==o&&null!==h&&o===e&&h===i||(this._previousWidth=e,this._previousHeight=i,this.resize())})),this._marker&&this.trackListener(google.maps.event.addListener(this._marker,"position_changed",()=>{this.draw()})),this._opts.showCloseButton&&!this._opts.closeButtonMarkup&&this.trackListener(google.maps.event.addDomListener(this._html.closeButton,"click",t=>{t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation(),this.close()})),["click","dblclick","rightclick","contextmenu","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup","touchstart","touchend","touchmove","wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"].forEach(t=>{this.trackListener(google.maps.event.addDomListener(this._html.wrapper,t,t=>{t.cancelBubble=!0,t.stopPropagation&&t.stopPropagation()}))}),this.activateCallback("open")}onRemove(){if(this.activateCallback("close"),this._html){const t=this._html.floatWrapper.parentElement;t&&t.removeChild(this._html.floatWrapper),this._html=null}this._isOpen=!1,this.activateCallback("afterClose")}getMapInnerBounds(){const t=this.getMap().getDiv().getBoundingClientRect(),e={top:t.top+this._opts.edgeOffset.top,right:t.right-this._opts.edgeOffset.right,bottom:t.bottom-this._opts.edgeOffset.bottom,left:t.left+this._opts.edgeOffset.left};return e.width=e.right-e.left,e.height=e.bottom-e.top,e}reposition(){if(!this._opts.panOnOpen||!this._html)return;const t=this.getMapInnerBounds(),e=this._html.wrapper.getBoundingClientRect();let s=0,i=0;t.left>=e.left?s=e.left-t.left:t.right<=e.right&&(s=e.left-(t.right-e.width)),t.top>=e.top?i=e.top-t.top:t.bottom<=e.bottom&&(i=e.top-(t.bottom-e.height)),0===s&&0===i||this.getMap().panBy(s,i)}resize(){if(!this._html)return;const t=this.getMapInnerBounds();let e=t.width;this._opts.maxWidth!==undefined&&(e=Math.min(e,this._opts.maxWidth)),e-=this._html.wrapper.offsetWidth-this._html.content.offsetWidth,this._html.content.style.maxWidth=`${e}px`;let s=t.height;this._opts.maxHeight!==undefined&&(s=Math.min(s,this._opts.maxHeight)),s-=this._html.wrapper.offsetHeight-this._html.content.offsetHeight,this._html.content.style.maxHeight=`${s}px`}};